#
# ZoidFS API: dispatcher implementation
#
MODULE_ARCHIVES := zoidfsdispatch
MODULE_SOURCES_zoidfsdispatch := $(addprefix dispatcher/, \
   	zoidfs.c \
	local/zoidfs-local.c \
	zint-handler.c \
   )

# If PVFS dispatcher plugin shoudl be built
ifdef DISPATCH_PVFS
   MODULE_SOURCES_zoidfsdispatch += $(addprefix dispatcher/pvfs/,\
   		zoidfs-pvfs2.c           \
        )
   MODULE_LDFLAGS_zoidfsdispatch += @PVFS2_LDFLAGS@
   MODULE_CPPFLAGS_zoidfsdispatch += @PVFS2_CPPFLAGS@
   MODULE_CFLAGS_zoidfsdispatch += @PVFS2_CFLAGS@
endif

# If libsysio dispatcher plugin should be built
ifdef DISPATCH_LIBSYSIO
   MODULE_SOURCES_zoidfsdispatch += $(addprefix dispatcher/sysio/,\
   		zoidfs-sysio.c           \
        )
   CPPFLAGS += @SYSIO_CPPFLAGS@ -D_LARGEFILE64_SOURCE -DHAVE_POSIX_1003_READLINK -D__USE_LARGEFILE64
   CFLAGS += @SYSIO_CFLAGS@ -D_LARGEFILE64_SOURCE -DHAVE_POSIX_1003_READLINK -D__USE_LARGEFILE64
   LDFLAGS += @SYSIO_LDFLAGS@ @SYSIO_LIBS@
   ifdef DISPATCH_PVFS
        LDFLAGS += @PVFS2_LDFLAGS@ -lcrypto -lpvfs2
   endif
endif

# always build posix2 dispatcher
ifdef DISPATCH_POSIX2
MODULE_SOURCES_zoidfsdispatch += $(addprefix dispatcher/posix2/,\
				 zoidfs-posix2.c \
				 fcache.c \
				 dcache.c \
				 )

ADDINTLIBS_zoidfsdispatch += c-util
endif

#
# Some C zoidfs utility functions
#
MODULE_ARCHIVES += zoidfscutil
MODULE_SOURCES_zoidfscutil := $(addprefix c-util/, \
   zoidfs-util.c )


#
#  C++ wrapper around the zoidfs API
#
MODULE_ARCHIVES += zoidfsutil
MODULE_SOURCES_zoidfsutil := $(addprefix util/, \
	ZoidFSAPI.cpp \
	ZoidFSSync.cpp \
	LogAPI.cpp \
	zoidfs-util.cpp \
	NullAPI.cpp \
        ZoidFSAsyncAPI.cpp \
    )
ADDINTLIBS_zoidfsutil := iofwdutil zoidfsdispatch

#
# ZoidFS API: forwarding implementation
#
MODULE_ARCHIVES += zoidfsclient 
MODULE_SOURCES_zoidfsclient := $(addprefix client/, \
   	zoidfsclient.c \
	bmi_comm.c \
	zoidfs_xdr.c \
   )

#
# ZoidFS API trace lib example
#
MODULE_ARCHIVES += zoidfsclienttrace
MODULE_SOURCES_zoidfsclienttrace := $(addprefix client/, \
    zoidfsclienttrace.c \
    zoidfsclient.c \
    bmi_comm.c \
    zoidfs_xdr.c \
    )
ADDINTLIBS_zoidfsclienttrace += zoidfsclient

# Automatically add -I$(thismoduledir) to CPPFLAGS
MODULE_CONTAINSINCLUDE := 1
